<!DOCTYPE HTML>
<html>
<head>
	<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<title>
		History.js
	</title>
</head>
<body style="padding-bottom:40px">
	<!-- Scripts -->
	
	<script src="../vendor/jquery.js"></script>
	<script src="../scripts/bundled/html4+html5/jquery.history.js"></script>

	<!-- HTML -->
	<div id="wrap">
		
		<!-- Textarea for Logging -->
		<textarea id="log" style="width:100%;height:400px"></textarea>
		<!-- Buttons -->
		<ul id="buttons">
		</ul>
     
		
	</div>
	<button onclick="button1('Harry Potter','Wizard')">Try it</button>
	<button onclick="button2()">Try it</button>
	



<script>
//routes


var routes = {
    index:function(){
        document.getElementById('log').value = "We're in the index";
    },
    data:function(){
        document.getElementById('log').value = "We're are in the data page";
    },
    movies:function(url,code1){
        document.getElementById('log').value = "Movies page "+code1;
    }
}

//Detect changes in th url event
window.onpopstate = history.onpushstate = function (evt) {
    var URL = window.location.protocol + "//" + window.location.host + "/" + window.location.pathname;
    var newURL=document.URL;
	

    // This function creates a new anchor element and uses location
    // properties (inherent) to get the desired URL data. Some String
    // operations are used (to normalize results across browsers).
     //code http://james.padolsey.com/javascript/parsing-urls-with-the-dom/
    function parseURL(url) {
        var a =  document.createElement('a');
        a.href = url;
        return {
            source: url,
            protocol: a.protocol.replace(':',''),
            host: a.hostname,
            port: a.port,
            query: a.search,
            params: (function(){
                var ret = {},
                    seg = a.search.replace(/^\?/,'').split('&'),
                    len = seg.length, i = 0, s;
                for (;i<len;i++) {
                    if (!seg[i]) { continue; }
                    s = seg[i].split('=');
                    ret[s[0]] = s[1];
                }
                return ret;
            })(),
            file: (a.pathname.match(/\/([^\/?#]+)$/i) || [,''])[1],
            hash: a.hash.replace('#',''),
            path: a.pathname.replace(/^([^\/])/,'/$1'),
            relative: (a.href.match(/tps?:\/\/[^\/]+(.+)/) || [,''])[1],
            segments: a.pathname.replace(/^\//,'').split('/')
        };
    }

    //the Test variable allow us to call a fonction contains in routes
    var test = function(obj_name, func_name, args) {
        // look for function name and call it
        var obj = window[obj_name];
        var func = obj[func_name];
        
        //console.log(obj);
        //console.log(func);
        
        var res = func.apply(null, args);
        return res;
    }



    var myURL=parseURL(newURL);
    if(myURL.query){
        var myString=myURL.query.split("?");
        var idString=myString[1].split("/id/");
        if(idString[1]){
            console.log(test('routes', idString[0], idString));
        }
        else if(myString[1]){
        console.log(test('routes', myString[1], [5, 3]));
        }
    }else{
        console.log(test('routes', 'index'));

    }
}



function button1(name,job)
{
	History.pushState({}, "", "?movies/id/8"); // logs {state:2,rand:"some random value"}, "State 2", "?state=2"
}
function button2()
{
	History.pushState({}, "", "?data"); // logs {state:2,rand:"some random value"}, "State 2", "?state=2"
}
</script>


</body>
</html>
